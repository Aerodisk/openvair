#################################
Сценарии использования:
#################################

Подключение по протоколу ISCSI
------------------------------
Для подключения ISCSI устройства необходимо иметь хранилище на удаленном 
сервере или хранилище данных (SAN). Этот сценарий описывает процесс 
подключения ISCSI устройства к серверу с использованием протокола ISCSI.

Процесс подключения:
====================
1. Получение IQN инициатора:
   Для обеспечения возможности подключения по протоколу ISCSI на стороне
   сервера необходимо добавить идентификатор квалифицированного имени (IQN)
   инициатора. Этот IQN можно получить, используя соответствующий веб-интерфейс:
   
   В левом боковом меню перейдите на страницу "Блочные устройства" и на открывшейся странице
   вы увидете доступный для копирования IQN текущего хоста

    .. figure:: /_static/img/block_devices/ISCSI/login/1_get_iqn.png
       :scale: 30 %
       :align: center
   
   Полученный IQN необходимо передать в качестве target на вашем удаленном сервере.

2. Логин в ISCSI устройство:
   После получения IQN инициатора можно произвести логин в ISCSI устройство.
   Это можно сделаеть с помощью соответствующего API, например:
   
   .. code-block:: bash

      POST /block-devices/login
      {
          "inf_type": "iscsi",
          "ip": "REMOTE_SERVER_IP",
          "port": "OPTIONAL_TARGET_PORT"
      }
        
   Где:

   - "inf_type" - тип используемого интерфейса.

   - "REMOTE_SERVER_IP" - IP адрес удаленного сервера или хранилища данных (SAN).

   - "OPTIONAL_TARGET_PORT" - необязательный параметр, указывающий порт, на котором ожидает подключение ISCSI устройство. Если порт не указан, будет использован порт по умолчанию (3260).

   Или через веб-интерфейс:

   Нажмите на кнопку "Логин":

    .. figure:: /_static/img/block_devices/ISCSI/login/2_login.png
       :scale: 30 %
       :align: center

   В поле "Тип" выберите "ISCSI"
   
   В поле "IP" укажите IP адрес удаленного сервера
   
   В поле "Порт" можно указать нужный порт (если оставить поле "Порт" пустым, то поставится порт по-умолчанию: 3260):
   
    .. figure:: /_static/img/block_devices/ISCSI/login/3_login.png
       :scale: 30 %
       :align: center
   
   После чего в таблице отобразится созданная сессия:

    .. figure:: /_static/img/block_devices/ISCSI/login/4_login.png
       :scale: 30 %
       :align: center
   
   Подключенное ISCSI устройство можно будет увидеть во вкладке "Физические диски":
   
    .. figure:: /_static/img/block_devices/ISCSI/login/5_phys_disks.png
       :scale: 30 %
       :align: center
   
   Для наглядности, вот как выглядела таблица физических дисков до того как мы подключили ISCSI устройство:

    .. figure:: /_static/img/block_devices/ISCSI/login/0_phys_disks_before.png
       :scale: 30 %
       :align: center
   
   И вот как выглядит эта же таблица после подключения ISCSI устройства:

    .. figure:: /_static/img/block_devices/ISCSI/login/6_phys_disks_after.png
       :scale: 30 %
       :align: center

После успешного выполнения этих шагов ISCSI устройство будет успешно 
подключено к серверу и готово к использованию.


Отключение от ISCSI устройства
------------------------------
Для отключения от ISCSI устройства можно использовать следующий API:

.. code-block:: bash

   POST /block-devices/logout
   {
       "inf_type": "iscsi",
       "ip": "REMOTE_SERVER_IP"
   }

   Где:

   - "inf_type" - тип используемого интерфейса.
   - "REMOTE_SERVER_IP" - IP адрес удаленного сервера или хранилища данных (SAN).

Или использоват веб-интерфейс:

   В таблице ISCSI сессий с правой стороны нажимаем на "три точки" в строке нужной нам сессии, появится всплывающая кнопка "Разлогинить", нажимаем на нее:

    .. figure:: /_static/img/block_devices/ISCSI/logout/1_logout.png
       :scale: 30 %
       :align: center
   
   Появится модальное окно с просьбой подтвердить удаление выбранной сессии, нажимаем "Разлогинить"

    .. figure:: /_static/img/block_devices/ISCSI/logout/2_logout.png
       :scale: 30 %
       :align: center
   
   После чего удаленная сессия пропадет из таблицы сессий:

    .. figure:: /_static/img/block_devices/ISCSI/logout/3_logout.png
       :scale: 30 %
       :align: center
   

Этот процесс позволяет корректно завершить сеанс работы с ISCSI устройством.

Подключение Fibre Channel
-------------------------


Для того чтобы увидеть в системе подключенные Fibre Channel устройства, необходимо произвести сканирование портов с использованием протокола LIP (Loop Initialization Protocol).
Для этого перейдите на страницу "Блочные устройства" и нажмите на кнопку "Сканировать (LIP)".

    .. figure:: /_static/img/block_devices/FC/0_scan.png
       :scale: 30 %
       :align: center

Появится модальное окно с описанием того, что сейчас будет происходить LIP сканирование, где так же нажимаем кнопку "Сканировать":

    .. figure:: /_static/img/block_devices/FC/1_scan_modal.png
       :scale: 30 %
       :align: center

   
После чего на странице "Физические диски" отобразятся подключенные Fibre Channel устройства:

    .. figure:: /_static/img/block_devices/FC/2_phys_disks.png
       :scale: 30 %
       :align: center
