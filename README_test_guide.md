
# üß™ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é API –≤ OpenVair

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è API-–º–æ–¥—É–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞ OpenVair. –û–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–∞–∫ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö, —Ç–∞–∫ –∏ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.

---

## üéØ –û–±—â–∏–µ —Ü–µ–ª–∏ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### –¶–µ–ª–∏

1. ‚úÖ –ü–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ.
2. üìò –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è API —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã.
3. üß† –§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π.
4. ‚ôªÔ∏è –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ ‚Äî —Ç–µ—Å—Ç—ã –≤—ã—è–≤–ª—è—é—Ç –ø–æ–ª–æ–º–∫–∏.
5. üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –æ—à–∏–±–æ–∫, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã** —á–µ—Ä–µ–∑ `TestClient` FastAPI.
- **–§–∏–∫—Å—Ç—É—Ä—ã** —É–ø—Ä–∞–≤–ª—è—é—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å—É—â–Ω–æ—Å—Ç–µ–π (`volume`, `storage`, –∏ —Ç.–¥.).
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏ ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (RabbitMQ, –ë–î, RPC).
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è **—Ä–µ–∞–ª—å–Ω–æ–µ API**, –∫–∞–∫ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º –∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏.
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è **–Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –æ—à–∏–±–æ–∫ –∏ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤**.

---

## üìã –ü–æ–¥—Ö–æ–¥ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π

1. üîç **–ê–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**:
   - –†–∞–∑–±–æ—Ä API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏, side-effects.

2. üóÇ **–°–±–æ—Ä –∫–æ–¥–∞**:
   - –°–æ–±–∏—Ä–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã: schemas, api, crud, service, domain, rpc, exceptions.
   - –ò–∑—É—á–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –≤—ã–∑–æ–≤–∞ –æ—Ç API –¥–æ –¥–æ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—è.

3. ‚úçÔ∏è **–§–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è**:
   - –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –∏ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.
   - –û–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è, –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

4. ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**:
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –ø–∏—à–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Ç–µ—Å—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test_create.py`).
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π `test_*` —Å –ø–æ–Ω—è—Ç–Ω—ã–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º.

5. üîÑ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã**:
   - –°–æ–∑–¥–∞—é—Ç—Å—è `test_storage`, `test_volume`, `attached_volume` –∏ –¥—Ä.
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è cleanup, mock auth, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pagination.

6. üß™ **–ó–∞–ø—É—Å–∫ –∏ –æ—Ç–ª–∞–¥–∫–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤.
   - –ü–æ–∏—Å–∫ flaky-—Ç–µ—Å—Ç–æ–≤.
   - –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

---

## üß© –ü–æ–¥—Ö–æ–¥ –¥–ª—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

1. üîç –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∏ —Å—Ö–µ–º (–¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).
2. ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ TDD-—Å—Ç–∏–ª—è —Ç–µ—Å—Ç–æ–≤ **–¥–æ –∫–æ–¥–∞**.
3. üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∫–∞–∫ "–∫—Ä–∞—Å–Ω—ã—Ö", —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω—É–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏.
4. üîÅ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –æ–ø–æ—Ä–æ–π –Ω–∞ —Ç–µ—Å—Ç—ã.
5. üìà –î–æ–±–∞–≤–ª–µ–Ω–∏–µ edge-–∫–µ–π—Å–æ–≤, –æ—à–∏–±–æ–∫, –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

## üìÅ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

```
openvair/
  modules/
    <module_name>/
      tests/
        api/
          test_create.py
          test_delete.py
          test_edit.py
          test_extend.py
          test_retrieve.py
        conftest.py
        config.py
        .env.test
```

---

## üîß Pytest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```
# openvair/modules/<module>/tests/pytest.ini
[pytest]
log_cli = true
log_cli_level = DEBUG
addopts = --order-scope=module
```

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pydantic-—Å—Ö–µ–º `CreateVolume` –≤ —Ç–µ—Å—Ç–∞—Ö.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `status_code`, —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –±–∏–∑–Ω–µ—Å-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.
- –í—ã–¥–µ–ª–µ–Ω–∏–µ id —Ç–æ–º–∞/—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ.

---

## üìå –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –§–∏–∫—Å—Ç—É—Ä—ã –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –≥–∏–±–∫–∏–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ —á–µ—Ä–µ–∑ `uuid4().hex[:6]`.
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî –¥–æ–ø—É—Å—Ç–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `unit_of_work` –∏ –∑–∞–ø–∏—Å—å –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î.
- –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (RabbitMQ) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å—Ä–µ–¥–µ CI/CD.



## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–ø—É—Å–∫–∞—Ç—å **–ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞** –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ–º –∫ –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–∏—Å—Ç–µ–º–µ. –í –∏–¥–µ–∞–ª–µ ‚Äî –Ω–∞ **—á–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ** –∏–ª–∏ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—è–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã, —Å–ª—É–∂–±—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, RabbitMQ) –∑–∞–ø—É—â–µ–Ω—ã, –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞, –∞ `.env`-—Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ä–µ–¥—ã –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–î–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª `.env.test`, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –º–æ–¥—É–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
openvair/modules/volume/tests/.env.test
```

–í –Ω—ë–º —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–∞–∫ –ø—É—Ç—å –¥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –¥—Ä—É–≥–∏–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö, –¥–ª—è –∏–∑–±–µ–≥–∞–Ω–∏—è —Ö–∞—Ä–¥–∫–æ–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```
TEST_STORAGE_PATH=/dev/vdb
TEST_STORAGE_FS_TYPE=ext4
```

–ó–∞–≥—Ä—É–∑–∫–∞ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é Pydantic (`pydantic-settings`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Ç–µ—Å—Ç–æ–≤ –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –≤ –¥—Ä—É–≥–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.